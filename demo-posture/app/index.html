
<!--

Starting from project root dir:

C:\Users\rstaudi\Devel\twoinone-extension\demo-posture>..\..\crosswalk64-19.48.502.0\xwalk.exe
    --external-extensions-path=C:\Users\rstaudi\Devel\twoinone-extension\demo-posture\twoinone-extension
    app\manifest.json

-->

<html>
    <head>
        <style>
            body {
                background-image: url("crosswalkproject-logo-horizontal-light.png");
                background-repeat: no-repeat;
                background-position: right top;

            }
            .element {
              position: relative;
              top: 50%;
              transform: translateY(-50%);
              text-align: center;
            }
        </style>
        <script>

            function fade(img, sign, callback) {

                sign = sign > 0 ? 1 : -1;
                var period = 1000 / 60; // 60 Hz
                var step = 1 / (250 / period);

                function fadeCb() {
                    console.log(img.style.opacity);
                    if (sign > 0 && img.style.opacity === "1" ||
                        sign < 0 && img.style.opacity === "0") {
                        if (callback)
                            callback();
                        return;
                    } else if (sign > 0) {
                        if (img.style.opacity + step > 1) {
                            img.style.opacity = 1;
                        } else {
                            img.style.opacity = parseFloat(img.style.opacity) + step;
                        }
                    } else if (sign < 0) {
                        if (img.style.opacity - step < 0) {
                            img.style.opacity = 0;
                        } else {
                            img.style.opacity = parseFloat(img.style.opacity) - step;
                        }
                    }
                    window.setTimeout(fadeCb, period);
                }
                window.setTimeout(fadeCb, period);
            }

            var _icons = ["icon-laptop.png", "icon-tablet.png"];
            var _i = 0;
            function test() {
                _i++;
                var img = document.getElementById("icon");
                fade(img, -1, function() {
                    img.src = _icons[_i % 2];
                    fade(img, 1, function() {});
                });
            }
            
            function main() {
                
                var img = document.getElementById("icon");
                img.src = _icons[_i];
                img.style.opacity = 1.0;
                
                if (twoinone) {
                    
                    var img = document.getElementById("icon");
                    img.src = twoinone.isTablet() ? "icon-tablet.png" : "icon-laptop.png";

                    twoinone.monitorTablet(function (isTablet) {                        
                        fade(img, -1, function() {
                            img.src = isTablet ? "icon-tablet.png" : "icon-laptop.png";
                            fade(img, 1, function() {});
                        });
                    });
                }
            }
        </script>
    </head>
    <body onload="main()" style="background-color: #0071c5">

        <div style="position: absolute; bottom: 10px">
            Status of &quot;twoinone&quot; extension: <input style="border:none; background-color: #0071c5; color: black;" id="status" type="text" value="" readonly>
            <script>
                var status = 'loading failed';
                try {
                    status = twoinone ? "loaded" : "";
                    twoinone.log(function(msg) {
                        // alert(msg);
                    });
                } catch (e) {
                    
                }
                document.getElementById('status').value = status;
            </script>
            <br />
            <input id="keyboard" type="button" value="Test" />
            <input id="tablet" type="button" value="Emulate Tablet Mode Switch" onclick="emulateTablet()" />
            <script>
                twoinone.monitorKeyboard(function (haveKeyboard) {
                    document.getElementById('keyboard').value = haveKeyboard ?
                                                                "hardware keyboard attached" :
                                                                "no keyboard";
                });
                
                function emulateTablet() {
                    var isTablet = twoinone.isTablet();
                    twoinone.emulator.setIsTablet(!isTablet);
                }
                
            </script>
        </div>
        
        <div class="element"><img id="icon" onclick="test()"/></div>

    </body>
</html>